<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> HÃ¹ng</title>
<style>
body{
  margin:0; font-family:sans-serif;
  background: linear-gradient(135deg,#ffc0cb,#ffe4e1);
  overflow:hidden;
}
#intro{
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  text-align:center;
}
#intro h1{font-size:2em; margin-bottom:10px;}
#intro input{padding:10px; font-size:1em;}
#startBtn{
  padding:12px 25px; font-size:1em; background:#ff69b4; border:none; border-radius:10px;
  cursor:pointer; transition:0.2s;
}
#startBtn:hover{transform:scale(1.2);}

/* READY MODAL */
#readyModal{
  display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.5);
  width:300px;padding:20px; background:#fff; border-radius:15px; text-align:center;
  box-shadow:0 0 20px rgba(0,0,0,0.5); opacity:0; z-index:10; transition:all 0.4s ease;
}
#readyModal.show{opacity:1; transform:translate(-50%,-50%) scale(1);}
#readyModal button{margin-top:15px; padding:10px 20px; cursor:pointer; border:none;
  border-radius:8px; background:#ff69b4; color:#fff; font-size:1em;}

/* GAME CONTAINER */
#gameContainer{display:none; flex-direction:column; align-items:center; width:80vw; margin:20px auto;}
#gameDiv{
  width:100%; height:70vh; background: rgba(255,192,203,0.2);
  border-radius:20px; overflow:hidden; position:relative; box-shadow:0 0 20px rgba(0,0,0,0.3);
}
#gameInfo{width:100%; margin-top:10px; text-align:center;}
#scoreboard{font-size:1.5em; color:#333;}
#healthBar{width:80%; height:20px; background:#eee; border-radius:10px; overflow:hidden; margin:5px auto;}
#healthBarInner{width:100%; height:100%; background:pink; transition:0.3s;}

/* ICON */
.icon{position:absolute; font-size:2em; cursor:pointer; user-select:none; transition: transform 0.2s, filter 0.2s;}
.icon:hover{transform:scale(1.5); filter:drop-shadow(0 0 5px #fff);}

/* BUTTONS OUTSIDE */
#shopBtn,#rulesBtn{
  position:absolute; top:10px; padding:10px 15px; border:none; border-radius:8px;
  background:#ff69b4; color:#fff; cursor:pointer; z-index:5;
}
#shopBtn{right:10px; display:none;} 
#rulesBtn{left:10px;} /* luÃ´n hiá»ƒn thá»‹ */

/* MODALS */
#shopModal,#rulesModal,#gameOverModal{
  display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width:300px;padding:20px; background:#fff; border-radius:10px;
  box-shadow:0 0 20px rgba(0,0,0,0.5); text-align:center; z-index:10;
}
#shopModal button,#rulesModal button,#gameOverModal button{
  padding:10px 20px; margin-top:15px; cursor:pointer; border:none; border-radius:8px; background:#ff69b4; color:#fff;
}

.shopItem{margin:10px 0; display:flex; justify-content:space-between; align-items:center;}
.chooseBtn{padding:5px 10px; background:#ff69b4; color:#fff; border:none; border-radius:5px; cursor:pointer;}
#confirmDiv{margin-top:15px; display:none;}
#confirmBtn{padding:8px 15px; background:#ff69b4; color:#fff; border:none; border-radius:8px; cursor:pointer;}

/* BY HUNG */
#byHung{position:absolute; bottom:10px; left:10px; color:#fff; font-weight:bold; font-size:1em; animation:fall 3s infinite;}
@keyframes fall{0%{transform:translateY(-20px); opacity:0;} 50%{opacity:1;} 100%{transform:translateY(0); opacity:1;}}

/* POPUP TRá»ª ÄIá»‚M */
#minusPopup{position:absolute; color:red; font-weight:bold; font-size:1.5em; animation:rise 1s forwards; pointer-events:none;}
@keyframes rise{0%{transform:translateY(0);opacity:1;} 100%{transform:translateY(-50px);opacity:0;}}
</style>
</head>
<body>

<!-- LOGIN / INTRO -->
<div id="intro">
  <h1 id="welcomeText">Nháº¥p vÃ´ lÃ  cÃ³ xiá»n ğŸ¤‘</h1>
  <input type="text" id="playerNameInput" placeholder="Nháº­p tÃªn cá»§a báº¡n">
  <button id="startBtn">Báº¯t Ä‘áº§u</button>
</div>

<!-- READY POPUP -->
<div id="readyModal">
  <h2 id="readyText">Báº¡n Ä‘Ã£ sáºµn sÃ ng chÆ°a?</h2>
  <button id="readyBtn">Báº¯t Ä‘áº§u</button>
</div>

<!-- GAME -->
<div id="gameContainer">
  <div id="gameDiv"></div>
  <div id="gameInfo">
    <div id="scoreboard">Äiá»ƒm: 0 | Tiá»n: 0 ğŸ’° | Máº¡ng: 10/10</div>
    <div id="healthBar"><div id="healthBarInner"></div></div>
  </div>
</div>

<!-- BUTTONS OUTSIDE -->
<button id="shopBtn">Shop ğŸ›’</button>
<button id="rulesBtn">â” Thá»ƒ lá»‡</button>

<!-- SHOP MODAL -->
<div id="shopModal">
  <h2>SHOP</h2>
  <div class="shopItem" data-point="1500" data-money="10000">
    1500 Ä‘iá»ƒm â†’ 10k VNÄ <button class="chooseBtn">Chá»n</button>
  </div>
  <div class="shopItem" data-point="3000" data-money="20000">
    3000 Ä‘iá»ƒm â†’ 20k VNÄ <button class="chooseBtn">Chá»n</button>
  </div>
  <div id="confirmDiv"><button id="confirmBtn">XÃ¡c nháº­n</button></div>
  <button id="closeShop">ÄÃ³ng</button>
</div>

<!-- RULES MODAL -->
<div id="rulesModal">
  <h2>Thá»ƒ lá»‡ Game</h2>
  <ul style="text-align:left">
    <li>âš¡ +10 Ä‘iá»ƒm</li>
    <li>â¤ï¸ +1 Ä‘iá»ƒm</li>
    <li>ğŸ’ +2 Ä‘iá»ƒm</li>
    <li>ğŸ€ +5 Ä‘iá»ƒm</li>
    <li>ğŸ +3 Ä‘iá»ƒm</li>
    <li>ğŸŒ Trá»« 1â€“200 Ä‘iá»ƒm</li>
    <li>Sá»‘ máº¡ng: 10</li>
    <li>Shop Ä‘á»•i Ä‘iá»ƒm ra tiá»n</li>
  </ul>
  <button id="closeRules">ÄÃ³ng</button>
</div>

<!-- GAME OVER -->
<div id="gameOverModal">
  <h2>ğŸ’€ Thua Ã²i! May máº¯n láº§n sau ğŸ€</h2>
  <button id="playAgainBtn">ChÆ¡i láº¡i ğŸ”„</button>
</div>

<div id="byHung">by HÃ¹ng ğŸ’–</div>

<script>
// --- BIáº¾N CHÃNH ---
let playerName, score=0, money=0, maxHealth=10, health=maxHealth, gameRunning=false;
const gameDiv=document.getElementById('gameDiv');
const scoreBoard=document.getElementById('scoreboard');
const healthBarInner=document.getElementById('healthBarInner');
const introDiv=document.getElementById('intro');
const readyModal=document.getElementById('readyModal');
const readyText=document.getElementById('readyText');

const iconTypes=[
  {icon:"âš¡", point:10, rate:0.2},
  {icon:"â¤ï¸", point:1, rate:0.3},
  {icon:"ğŸ’", point:2, rate:0.15},
  {icon:"ğŸ€", point:5, rate:0.1},
  {icon:"ğŸ", point:3, rate:0.1},
  {icon:"ğŸŒ", point:-Math.floor(Math.random()*200+1), rate:0.15}
];

// --- LOGIN ---
document.getElementById('startBtn').addEventListener('click', ()=>{
  const playerInput=document.getElementById('playerNameInput').value.trim();
  if(!playerInput) return alert("Nháº­p tÃªn trÆ°á»›c!");
  playerName=playerInput;

  const data=JSON.parse(localStorage.getItem(playerName));
  const welcomeText=document.getElementById('welcomeText');
  if(data){welcomeText.textContent=`ChÃºc má»«ng Ä‘Ã£ quay láº¡i, ${playerName}! ğŸ‰`; score=data.score; money=data.money; health=data.health;}
  else{welcomeText.textContent=`ChÃ o má»«ng Ä‘áº¿n vá»›i game cá»§a HÃ¹ng, ${playerName}! ğŸ¥³`; score=0; money=0; health=maxHealth;}
  if(playerName==='hungadmin'){score=Infinity; money=Infinity; health=Infinity; welcomeText.textContent=`ChÃ o má»«ng hungadmin! VÃ´ háº¡n Ä‘iá»ƒm & tiá»n ğŸ’`;}

  setTimeout(()=>{
    introDiv.style.display='none';
    readyText.textContent=`Báº¡n Ä‘Ã£ sáºµn sÃ ng chÆ°a, ${playerName}?`;
    readyModal.style.display='block';
    setTimeout(()=>readyModal.classList.add('show'),50);
  },500);
});

// --- READY POPUP ---
document.getElementById('readyBtn').addEventListener('click', ()=>{
  readyModal.classList.remove('show');
  setTimeout(()=>readyModal.style.display='none',400);

  document.getElementById('gameContainer').style.display='flex';
  document.getElementById('shopBtn').style.display='block';

  if(playerName!=='hungadmin') gameRunning=true;
  updateScoreBoard();
  if(playerName!=='hungadmin') spawnIcons();
});

// --- UPDATE SCOREBOARD ---
function updateScoreBoard(){
  scoreBoard.textContent=`Äiá»ƒm: ${score} | Tiá»n: ${money} ğŸ’° | Máº¡ng: ${health}/${maxHealth}`;
  healthBarInner.style.width=(health/maxHealth*100)+'%';
}

// --- SPAWN ICONS ---
function spawnIcons(){
  if(!gameRunning) return;
  const iconType=pickIcon();
  const iconEl=document.createElement('div');
  iconEl.classList.add('icon');
  iconEl.textContent=iconType.icon;

  const gameRect=gameDiv.getBoundingClientRect();
  const leftPos=Math.random()*(gameRect.width-50);
  iconEl.style.left=leftPos+'px';
  iconEl.style.top='-50px';
  gameDiv.appendChild(iconEl);

  const fallInterval=setInterval(()=>{
    let top=parseFloat(iconEl.style.top);
    if(top+50>=gameRect.height){
      clearInterval(fallInterval);
      iconEl.remove();
      if(iconType.point<0) loseHealth(Math.abs(iconType.point));
      updateScoreBoard();
      checkGameOver();
    }else iconEl.style.top=(top+2)+'px';
  },20);

  iconEl.addEventListener('click', ()=>{
    if(iconType.point>0){score+=iconType.point; money+=iconType.point;}
    else loseHealth(Math.abs(iconType.point));
    iconEl.remove();
    updateScoreBoard();
    checkGameOver();
  });

  setTimeout(spawnIcons,1000);
}
function pickIcon(){
  const rand=Math.random(); let sum=0;
  for(const it of iconTypes){sum+=it.rate; if(rand<=sum) return it;}
  return iconTypes[0];
}

// --- Máº¤T Máº NG ---
function loseHealth(value){
  if(playerName==='hungadmin') return;
  health--;
  const popup=document.createElement('div');
  popup.id='minusPopup';
  popup.textContent='-'+value;
  popup.style.left=(Math.random()*50+25)+'%';
  popup.style.top='50%';
  document.body.appendChild(popup);
  setTimeout(()=>popup.remove(),1000);
}

// --- CHECK GAME OVER ---
const gameOverModal=document.getElementById('gameOverModal');
function checkGameOver(){
  if(playerName!=='hungadmin' && health<=0){
    gameRunning=false;
    gameOverModal.style.display='block';
  }
}
document.getElementById('playAgainBtn').addEventListener('click',()=>{
  score=0; money=0; health=maxHealth;
  gameOverModal.style.display='none';
  gameRunning=true;
  updateScoreBoard();
  spawnIcons();
});

// --- SHOP ---
const shopBtn=document.getElementById('shopBtn');
const shopModal=document.getElementById('shopModal');
const closeShop=document.getElementById('closeShop');
const chooseBtns=document.querySelectorAll('.chooseBtn');
const confirmDiv=document.getElementById('confirmDiv');
const confirmBtn=document.getElementById('confirmBtn');
let selectedItem=null;

shopBtn.addEventListener('click',()=>{shopModal.style.display='block'; gameRunning=false;});
closeShop.addEventListener('click',()=>{shopModal.style.display='none'; gameRunning=true; spawnIcons();});

chooseBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    selectedItem=btn.parentElement;
    confirmDiv.style.display='block';
  });
});

confirmBtn.addEventListener('click', ()=>{
  if(!selectedItem) return;
  const cost=parseInt(selectedItem.dataset.point);
  const reward=parseInt(selectedItem.dataset.money);
  if(score>=cost){
    score-=cost;
    money+=reward;
    updateScoreBoard();
    alert("ğŸ“¸ Cap mÃ n hÃ¬nh gá»­i cho HÃ¹ng Ä‘á»ƒ nháº­n thÆ°á»Ÿng ğŸ’°");
  } else alert("Xin lá»—i, chÆ°a Ä‘á»§ Ä‘iá»ƒm!");
  confirmDiv.style.display='none';
  selectedItem=null;
});

// --- RULES ---
const rulesBtn=document.getElementById('rulesBtn');
const rulesModal=document.getElementById('rulesModal');
const closeRules=document.getElementById('closeRules');
rulesBtn.addEventListener('click',()=>{rulesModal.style.display='block'; gameRunning=false;});
closeRules.addEventListener('click',()=>{rulesModal.style.display='none'; if(playerName!=='hungadmin') gameRunning=true; spawnIcons();});

// --- LÆ¯U Dá»® LIá»†U ---
setInterval(()=>{if(playerName) localStorage.setItem(playerName,JSON.stringify({score,money,health}));},2000);
</script>
</body>
  </html>
