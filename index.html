<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> HÃ¹ng táº¡o cÃ´ng Äƒn viá»‡c lÃ m</title>
<style>
body{
  margin:0; font-family:sans-serif;
  background: linear-gradient(135deg,#ffc0cb,#ffe4e1);
  overflow:hidden;
}

/* LOGIN / INTRO */
@keyframes shake {
  0% { transform: translate(-50%, -50%) translateX(0); }
  25% { transform: translate(-50%, -50%) translateX(-5px); }
  50% { transform: translate(-50%, -50%) translateX(5px); }
  75% { transform: translate(-50%, -50%) translateX(-5px); }
  100% { transform: translate(-50%, -50%) translateX(0); }
}
#intro{
  position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  text-align:center;
  background: linear-gradient(135deg,#ff4d94,#ff66b3);
  padding:30px; border-radius:20px; box-shadow:0 0 20px rgba(0,0,0,0.3);
  animation: shake 1s infinite;
}
#intro h1{font-size:2em; margin-bottom:10px;}
#intro input{padding:10px; font-size:1em;}
#startBtn{
  padding:12px 25px; font-size:1em; background:#ff69b4; border:none; border-radius:10px;
  cursor:pointer; transition:0.2s;
}
#startBtn:hover{transform:scale(1.2);}

/* READY MODAL */
#readyModal{
  display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%) scale(0.5);
  width:300px;padding:20px; background:#fff; border-radius:15px; text-align:center;
  box-shadow:0 0 20px rgba(0,0,0,0.5); opacity:0; z-index:10; transition:all 0.4s ease;
}
#readyModal.show{opacity:1; transform:translate(-50%,-50%) scale(1);}
#readyModal button{margin-top:15px; padding:10px 20px; cursor:pointer; border:none;
  border-radius:8px; background:#ff69b4; color:#fff; font-size:1em;}

/* GAME CONTAINER */
#gameContainer{display:none; flex-direction:column; align-items:center; width:80vw; margin:20px auto;}
#gameDiv{
  width:100%; height:70vh; background: rgba(255,192,203,0.2);
  border-radius:20px; 
  border:6px solid #ff1493;
  overflow:hidden; position:relative; box-shadow:0 0 20px rgba(0,0,0,0.3);
}
#dangerLine{
  position:absolute; bottom:0; left:0; width:100%; height:5px; background:red; opacity:0.5;
}
#gameInfo{width:100%; margin-top:10px; text-align:center;}
#scoreboard{font-size:1.5em; color:#333;}
#healthBar{width:80%; height:20px; background:#eee; border-radius:10px; overflow:hidden; margin:5px auto;}
#healthBarInner{width:100%; height:100%; background:pink; transition:0.3s;}

/* ICON */
.icon{position:absolute; font-size:2em; cursor:pointer; user-select:none; transition: transform 0.2s, filter 0.2s;}
.icon:hover{transform:scale(1.5); filter:drop-shadow(0 0 5px #fff);}

/* BUTTONS OUTSIDE */
#rulesBtn,#exchangeBtn{
  position:absolute; top:10px; padding:10px 15px; border:none; border-radius:8px;
  background:#ff69b4; color:#fff; cursor:pointer; z-index:5;
}
#rulesBtn{left:10px;}
#exchangeBtn{right:10px;}

/* MODALS */
#rulesModal,#gameOverModal,#exchangeModal{
  display:none; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
  width:300px;padding:20px; background:#fff; border-radius:10px;
  box-shadow:0 0 20px rgba(0,0,0,0.5); text-align:center; z-index:10;
}
#rulesModal button,#gameOverModal button,#exchangeModal button{
  padding:10px 20px; margin-top:15px; cursor:pointer; border:none; border-radius:8px; background:#ff69b4; color:#fff;
}

/* BY HUNG */
#byHung{position:absolute; bottom:10px; left:10px; color:#fff; font-weight:bold; font-size:1em; text-shadow:1px 1px 2px rgba(0,0,0,0.5); animation:fall 3s infinite;}
@keyframes fall{0%{transform:translateY(-20px); opacity:0;} 50%{opacity:1;} 100%{transform:translateY(0); opacity:1;}}

/* POPUP TRá»ª ÄIá»‚M */
#minusPopup{position:absolute; color:red; font-weight:bold; font-size:1.5em; animation:rise 1s forwards; pointer-events:none;}
@keyframes rise{0%{transform:translateY(0);opacity:1;} 100%{transform:translateY(-50px);opacity:0;}}
</style>
</head>
<body>

<!-- LOGIN / INTRO -->
<div id="intro">
  <h1 id="welcomeText"> KÃ­m tiá»n ko khÃ³ ğŸ¤‘</h1>
  <input type="text" id="playerNameInput" placeholder="Nháº­p tÃªn cá»§a báº¡n">
  <button id="startBtn">Báº¯t Ä‘áº§u</button>
</div>

<!-- READY POPUP -->
<div id="readyModal">
  <h2 id="readyText">Báº¡n Ä‘Ã£ sáºµn sÃ ng chÆ°a?</h2>
  <button id="readyBtn">Báº¯t Ä‘áº§u</button>
</div>

<!-- GAME -->
<div id="gameContainer">
  <div id="gameDiv">
    <div id="dangerLine"></div>
  </div>
  <div id="gameInfo">
    <div id="scoreboard">Äiá»ƒm: 0 | Máº¡ng: 10/10</div>
    <div id="healthBar"><div id="healthBarInner"></div></div>
  </div>
</div>

<!-- BUTTONS -->
<button id="rulesBtn">â” Thá»ƒ lá»‡</button>
<button id="exchangeBtn">ğŸ’° Äá»•i Ä‘iá»ƒm</button>

<!-- RULES MODAL -->
<div id="rulesModal">
  <h2>Thá»ƒ lá»‡ Game</h2>
  <ul style="text-align:left">
    <li>âš¡ +10 Ä‘iá»ƒm</li>
    <li>â¤ï¸ +1 Ä‘iá»ƒm</li>
    <li>ğŸ’ +2 Ä‘iá»ƒm</li>
    <li>ğŸ€ +5 Ä‘iá»ƒm</li>
    <li>ğŸ +3 Ä‘iá»ƒm</li>
    <li>ğŸŒ Nháº¥n Ä‘á»ƒ trá»« Ä‘iá»ƒm 1â€“200</li>
    <li>Má»—i ngÆ°á»i chÆ¡i cÃ³ 10 máº¡ng</li>
    <li>Thanh Ä‘á» cuá»‘i khung: cÃ¡c icon (ngoáº¡i trá»« ğŸŒ) náº¿u rÆ¡i cháº¡m â†’ máº¥t 1 máº¡ng</li>
  </ul>
  <button id="closeRules">ÄÃ³ng</button>
</div>

<!-- EXCHANGE MODAL -->
<div id="exchangeModal">
  <h2>Äá»•i Ä‘iá»ƒm sang pháº§n thÆ°á»Ÿng</h2>
  <p id="exchangeInfo"></p>
  <button id="confirmExchange">XÃ¡c nháº­n</button>
</div>

<!-- GAME OVER -->
<div id="gameOverModal">
  <h2>ğŸ’€ Thua Ã²i! May máº¯n láº§n sau ğŸ€</h2>
  <button id="playAgainBtn">ChÆ¡i láº¡i ğŸ”„</button>
</div>

<div id="byHung">by HÃ¹ng ğŸ’–</div>

<script>
// --- BIáº¾N CHÃNH ---
let playerName, score=0, maxHealth=10, health=maxHealth, gameRunning=false;
const gameDiv=document.getElementById('gameDiv');
const scoreBoard=document.getElementById('scoreboard');
const healthBarInner=document.getElementById('healthBarInner');
const introDiv=document.getElementById('intro');
const readyModal=document.getElementById('readyModal');
const readyText=document.getElementById('readyText');

const iconTypes=[
  {icon:"âš¡", point:10, rate:0.2},
  {icon:"â¤ï¸", point:1, rate:0.3},
  {icon:"ğŸ’", point:2, rate:0.15},
  {icon:"ğŸ€", point:5, rate:0.1},
  {icon:"ğŸ", point:3, rate:0.1},
  {icon:"ğŸŒ", point:0, rate:0.15} // trá»« Ä‘iá»ƒm khi báº¥m
];

// --- LOGIN ---
document.getElementById('startBtn').addEventListener('click', ()=>{
  const playerInput=document.getElementById('playerNameInput').value.trim();
  if(!playerInput) return alert("Nháº­p tÃªn trÆ°á»›c!");
  playerName=playerInput;

  const data=JSON.parse(localStorage.getItem(playerName));
  const welcomeText=document.getElementById('welcomeText');
  if(data){welcomeText.textContent=`ChÃºc má»«ng Ä‘Ã£ quay láº¡i, ${playerName}! ğŸ‰`; score=data.score; health=data.health;}
  else{welcomeText.textContent=`ChÃ o má»«ng Ä‘áº¿n vá»›i game cá»§a HÃ¹ng, ${playerName}! ğŸ¥³`; score=0; health=maxHealth;}
  if(playerName==='hungadmin'){score=Infinity; health=Infinity; welcomeText.textContent=`ChÃ o má»«ng hungadmin! VÃ´ háº¡n Ä‘iá»ƒm ğŸ’`;}

  setTimeout(()=>{
    introDiv.style.display='none';
    readyText.textContent=`Báº¡n Ä‘Ã£ sáºµn sÃ ng chÆ°a, ${playerName}?`;
    readyModal.style.display='block';
    setTimeout(()=>readyModal.classList.add('show'),50);
  },500);
});

// --- READY POPUP ---
document.getElementById('readyBtn').addEventListener('click', ()=>{
  readyModal.classList.remove('show');
  setTimeout(()=>readyModal.style.display='none',400);

  document.getElementById('gameContainer').style.display='flex';

  if(playerName!=='hungadmin') gameRunning=true;
  updateScoreBoard();
  if(playerName!=='hungadmin') spawnIcons();
});

// --- UPDATE SCOREBOARD ---
function updateScoreBoard(){
  scoreBoard.textContent=`Äiá»ƒm: ${score} | Máº¡ng: ${health}/${maxHealth}`;
  healthBarInner.style.width=(health/maxHealth*100)+'%';
}

// --- SPAWN ICONS ---
function spawnIcons(){
  if(!gameRunning) return;
  const iconType=pickIcon();
  const iconEl=document.createElement('div');
  iconEl.classList.add('icon');
  iconEl.textContent=iconType.icon;

  const gameRect=gameDiv.getBoundingClientRect();
  const leftPos=Math.random()*(gameRect.width-50);
  iconEl.style.left=leftPos+'px';
  iconEl.style.top='-50px';
  gameDiv.appendChild(iconEl);

  const fallSpeed = Math.random() * 3 + 2; // 2~5px/20ms
  const fallInterval=setInterval(()=>{
    let top=parseFloat(iconEl.style.top);
    if(top + 50 >= gameRect.height){
      clearInterval(fallInterval);
      iconEl.remove();
      if(iconType.icon !== 'ğŸŒ'){
        health -= 1;
        updateScoreBoard();
        checkGameOver();
      }
    }else iconEl.style.top=(top + fallSpeed)+'px';
  },20);

  iconEl.addEventListener('click', ()=>{
    if(iconType.icon==='ğŸŒ'){
      const lost = Math.floor(Math.random()*200)+1;
      score -= lost;
      showMinusPopup(-lost);
    } else {
      score += iconType.point;
    }
    iconEl.remove();
    updateScoreBoard();
  });

  const nextSpawn = Math.random() * 700 + 300; // 0.3~1s
  setTimeout(spawnIcons, nextSpawn);
}

function pickIcon(){
  const rand=Math.random(); let sum=0;
  for(const it of iconTypes){sum+=it.rate; if(rand<=sum) return it;}
  return iconTypes[0];
}

// --- POPUP TRá»ª ÄIá»‚M ---
function showMinusPopup(value){
  const popup=document.createElement('div');
  popup.id='minusPopup';
  popup.textContent=value;
  popup.style.left=(Math.random()*50+25)+'%';
  popup.style.top='50%';
  document.body.appendChild(popup);
  setTimeout(()=>popup.remove(),1000);
}

// --- GAME OVER ---
const gameOverModal=document.getElementById('gameOverModal');
function checkGameOver(){
  if(playerName!=='hungadmin' && health<=0){
    gameRunning=false;
    gameOverModal.style.display='block';
  }
}
document.getElementById('playAgainBtn').addEventListener('click',()=>{
  score=0; health=maxHealth;
  gameOverModal.style.display='none';
  gameRunning=true;
  updateScoreBoard();
  spawnIcons();
});

// --- RULES ---
const rulesBtn=document.getElementById('rulesBtn');
const rulesModal=document.getElementById('rulesModal');
const closeRules=document.getElementById('closeRules');
rulesBtn.addEventListener('click',()=>{rulesModal.style.display='block'; gameRunning=false;});
closeRules.addEventListener('click',()=>{rulesModal.style.display='none'; if(playerName!=='hungadmin') gameRunning=true; spawnIcons();});

// --- EXCHANGE ---
const exchangeBtn=document.getElementById('exchangeBtn');
const exchangeModal=document.getElementById('exchangeModal');
const exchangeInfo=document.getElementById('exchangeInfo');
const confirmExchange=document.getElementById('confirmExchange');

exchangeBtn.addEventListener('click',()=>{
  gameRunning=false;
  if(score>=1500) exchangeInfo.textContent="Báº¡n cÃ³ Ä‘á»§ Ä‘iá»ƒm! ğŸ“¸ Cap mÃ n hÃ¬nh gá»­i cho HÃ¹ng Ä‘á»ƒ nháº­n thÆ°á»Ÿng ğŸ’°";
  else exchangeInfo.textContent="Xin lá»—i, chÆ°a Ä‘á»§ Ä‘iá»ƒm nha nÃ­ ğŸ¥¹";
  exchangeModal.style.display='block';
});

confirmExchange.addEventListener('click',()=>{
  exchangeModal.style.display='none';
  if(playerName!=='hungadmin') gameRunning=true;
});

// --- LÆ¯U Dá»® LIá»†U ---
setInterval(()=>{if(playerName) localStorage.setItem(playerName,JSON.stringify({score,health}));},2000);
</script>
</body>
</html>
